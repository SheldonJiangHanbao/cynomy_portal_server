//- create by afterloe on 2017-2-15 11:29:13 - MIT

include header

link(href= static + "css/portal/directory.css" rel="stylesheet")
link(href= static + "css/portal/mask.css" rel="stylesheet")

div(class="popup")
  div(class="mask")
    div(class="box")
      header
        span My Research V1.1 输出资料
        span(class="btn_close")
      form(action="" class="form")
        div(class="file")
          span 上传文件为定位、价值、关键特性、路标、原型等资料
          span
            input(type="file" placeholder="" id="source")
            input(type="button" value="上传文档" id="uploadFile")
        div(class="description")
          ul(class="dataFile")
        div(class="last")
          span 上传人：
          span
            input(type="text" placeholder="输入姓名")
          span
            button(class="submit_re") 开始上传

div(class="container directory_content")
  div(class="proposal")
  div(class="tab_process")
    dl(class="processActive")
      dt
        a(href="javascript:void(0);" class="tabIcon tabIcon_plan")
        span 产品规划
      dd &bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;
      div(class="clear")
    dl
      dt
        a(href="javascript:void(0);" class="tabIcon tabIcon_design")
        span 产品设计
      dd &bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;
      div(class="clear")
    dl
      dt
        a(href="javascript:void(0);" class="tabIcon tabIcon_development")
        span 产品设计
      dd &bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;
      div(class="clear")
    dl
      dt
        a(href="javascript:void(0);" class="tabIcon tabIcon_test")
        span 产品设计
      dd &bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;
      div(class="clear")
    dl
      dt
        a(href="javascript:void(0);" class="tabIcon tabIcon_release")
        span 产品设计
      dd &bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;
      div(class="clear")

  div(class="tab_content")
    div(class="dataBox")
      div(class="header")= locals.produceName + "资料"
        span(class="upload")
      - const _files = locals.produceList || [];
      ul(class="data")
        each _file in _files
          li
            div
              i
              span(class="name")=_file.name
              span(class="time")=_file.uploadTime? new Date(_file.uploadTime).toLocaleString() : new Date().toLocaleString()
              span=_file.downloadCount || 0
              span=_file.author.name
              span(data-id=_file._id class="download" onClick="javascript:downLoadFile(this);")

include footer

script(src= static + "js/portal/rem.js")

script.
  $(function() {
      //弹窗出来后的一些操作
      var input = document.getElementById("source");
      //文件域选择文件时, 执行readFile函数,把上传的文档信息放置dataFile中
      input.addEventListener('change', readFile, false);
      var i = 1;
      function readFile() {
          var file = this.files[0];
          console.log(file)
          console.log("文件名:" + file.name);
          console.log("文件类型:" + file.type);
          console.log("文件大小:" + file.size);
          var date = new Date();
          var dateString = date.toLocaleDateString();

          //把每次上传的文档名字传入dataFile
          var html = "<li><span>" + (i++) + "、</span><span>" + file.name + "</span><span>" + dateString + "</span><span class='closeFile'></span></li>";
          $(".dataFile").append(html);
          //点击关闭按钮，取消该项文档的添加
          $(".closeFile").on("click", function() {
              console.log($(this).parent("li"))
              $(this).parent("li").remove();
          });
      }

      // 点击反馈跳转到bbs
      $(".proposal").bind("click", function() {
          window.open("http://bbs.jwis.cn");
      });

      //关闭遮罩层
      $(".btn_close").on("click", function() {
          $(".popup").css("display", "none");
      });

      //打开遮罩层
      $(".upload").on("click", function() {
          $(".popup").css("display", "block");
      });

      //点击关闭按钮，取消该项文档的添加
      $(".dataClose").on("click", function() {
          console.log($(this).parent("div").parent("li"))
          $(this).parent("div").parent("li").remove();
      });

      //tab切换
      $("body .tab_process").find("dl").on("click", function() {
          $(this).addClass("processActive").siblings("dl").removeClass("processActive");
          //每次点击 更换dataBox中的内容
      });

  });

  const downLoadFile = (btn) => {
    window.open("/fs/download/" + $(btn).attr("data-id"));
  };
